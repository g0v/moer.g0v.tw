<!DOCTYPE HTML>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>焚化廠空污檢測資料</title>
    <style type="text/css" media="screen">
      .bar {
        fill: firebrick;
      }
      .chart text {
        fill: white;
      }
    </style>
  </head>
  <body>
  <p>Incinerator air polution data retrieved from <a href="http://opendata.epa.gov.tw/ws/Data/SWIMSAir/?1orderby=ReportDate%20desc11skip=011top=10001format=json">here</a>.</p>
    <svg class="chart"></svg>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script type="text/javascript" charset="utf-8">
      var width = 960,
        barHeight = 25;

      var x = d3.scale.linear()
        .range([0, width]);

      var chart = d3.select(".chart")
        .attr("width", width);

      d3.json("incinerator-air-polution.json", function(error, data) {
        x.domain([0, d3.max(data, function(d) { return +d.NOx; })]);

        chart.attr("height", barHeight * data.length);

        var bar = chart.selectAll("g")
          .data(data)
          .enter().append("g")
          .attr("transform", function(d, i) { return "translate(0," + i * barHeight + ")"; });

        bar.append("rect")
          .attr("class", "bar")
          .attr("width", function(d) { return x(+d.NOx); })
          .attr("height", barHeight - 1);

        bar.append("text")
          .attr("x", function(d) { return x(+d.NOx) - d.NOx.length * 9; })
          .attr("y", barHeight / 2)
          .attr("dy", ".35em")
          .text(function(d) { return d.NOx; });

        bar.append("text")
          .attr("x", 0)
          .attr("y", barHeight / 2)
          .attr("dx", ".2em")
          .attr("dy", ".35em")
          .text(function(d) { return d.IncineratorName + " (" + d.ReportDate + ")"; });
      });
    </script>
  </body>
</html>
